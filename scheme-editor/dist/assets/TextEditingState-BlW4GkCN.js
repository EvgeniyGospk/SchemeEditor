var a=Object.defineProperty;var h=(s,e,t)=>e in s?a(s,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):s[e]=t;var o=(s,e,t)=>h(s,typeof e!="symbol"?e+"":e,t);import{ChangePropertyCommand as d}from"./ChangePropertyCommand-y99FPjLw.js";import{DefaultState as p}from"./DefaultState-B1tIFoJh.js";import{L as r}from"./index-DKNJtNe6.js";import"./DeleteElementCommand-qGrwhnDa.js";class I{constructor(){o(this,"editingShapeId","");o(this,"originalText","");o(this,"textInputElement");o(this,"currentShape");o(this,"updatePositionHandler",()=>{this.updateTextInputPosition()})}getStateName(){return"TextEditingState"}onEnterState(e,t){if(!(t!=null&&t.shapeId)){e.setState(new p);return}this.editingShapeId=t.shapeId;const i=e.getDependencies().scheme.getShapeById(this.editingShapeId);if(!i){e.setState(new p);return}const l=i.getProperties();this.originalText=l.text||"",this.currentShape=i,this.createTextInput(i),this.addEventListeners()}onExitState(){this.removeEventListeners(),this.textInputElement&&(this.textInputElement.remove(),this.textInputElement=void 0),this.editingShapeId="",this.originalText="",this.currentShape=void 0}handleMouseDown(e,t){const{target:n}=e;n!==this.textInputElement&&(this.applyTextChanges(t),t.setState(new p))}handleMouseMove(){}handleMouseUp(){}handleDoubleClick(){}handleKeyDown(e,t){switch(e.key){case"Enter":e.shiftKey||(this.applyTextChanges(t),t.setState(new p));break;case"Escape":this.textInputElement&&(this.textInputElement.value=this.originalText),t.setState(new p);break}}handleKeyUp(){}createTextInput(e){if(typeof document>"u")return;const t=e.getBounds(),n=document.querySelector("canvas");if(!n)return;const i=n.getBoundingClientRect();this.textInputElement=document.createElement("textarea"),this.textInputElement.value=this.originalText,this.textInputElement.style.position="fixed",this.textInputElement.style.left=`${i.left+t.x}px`,this.textInputElement.style.top=`${i.top+t.y}px`,this.textInputElement.style.width=`${Math.max(t.width,100)}px`,this.textInputElement.style.height=`${Math.max(t.height,50)}px`,this.textInputElement.style.border="2px solid #007acc",this.textInputElement.style.borderRadius="4px",this.textInputElement.style.padding="4px",this.textInputElement.style.fontSize="14px",this.textInputElement.style.fontFamily="Arial, sans-serif",this.textInputElement.style.resize="none",this.textInputElement.style.outline="none",this.textInputElement.style.backgroundColor="white",this.textInputElement.style.zIndex="1000",this.textInputElement.style.boxShadow="0 2px 8px rgba(0,0,0,0.2)",document.body.appendChild(this.textInputElement),setTimeout(()=>{this.textInputElement&&(this.textInputElement.focus(),this.textInputElement.select())},10)}applyTextChanges(e){if(!this.textInputElement)return;const t=this.textInputElement.value;if(t!==this.originalText){const n=e.getDependencies(),i=new d(n.scheme,this.editingShapeId,{text:t});n.commandManager.executeCommand(i)}else r.info("TextEditingState: No text changes to apply")}addEventListeners(){typeof window>"u"||(window.addEventListener("resize",this.updatePositionHandler),window.addEventListener("scroll",this.updatePositionHandler))}removeEventListeners(){typeof window>"u"||(window.removeEventListener("resize",this.updatePositionHandler),window.removeEventListener("scroll",this.updatePositionHandler))}updateTextInputPosition(){if(!this.currentShape)return;const e=this.currentShape.getBounds(),t=document.querySelector("canvas");if(!t)return;const n=t.getBoundingClientRect();this.textInputElement&&(this.textInputElement.style.left=`${n.left+e.x}px`,this.textInputElement.style.top=`${n.top+e.y}px`)}}export{I as TextEditingState};
